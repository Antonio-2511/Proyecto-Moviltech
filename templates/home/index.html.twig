{% extends 'base.html.twig' %}

{% block title %}Catálogo{% endblock %}

{% block body %}

    <div class="container mt-4">

        <h1 class="mb-4">Catálogo de productos</h1>

        {# ============================= #}
        {# FILTRO DE CATEGORÍAS         #}
        {# ============================= #}
        <div class="mb-4">
            <form method="get">
                <select name="categoria"
                        class="form-select w-auto"
                        onchange="this.form.submit()">

                    <option value="">Todas las categorías</option>

                    {% for categoria in categorias %}
                        <option value="{{ categoria.id }}"
                            {% if categoria.id == categoriaSeleccionada %}
                        selected
                            {% endif %}>
                            {{ categoria.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>

        {# ============================= #}
        {# GRID DE PRODUCTOS            #}
        {# ============================= #}
        <div class="row">
            {% for producto in productos %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm">

                        {% if producto.imagen %}
                            <img src="{{ producto.imagen }}"
                                 class="card-img-top"
                                 alt="{{ producto.nombre }}">
                        {% endif %}

                        <div class="card-body d-flex flex-column">

                            <h5 class="card-title">
                                {{ producto.nombre }}
                            </h5>

                            <p class="card-text">
                                {{ producto.descripcion|slice(0, 80) }}...
                            </p>

                            <p class="fw-bold">
                                {{ producto.precio }} €
                            </p>

                            <div class="mt-auto d-flex gap-2">
                                <a href="{{ path('catalogo_producto', {'id': producto.id}) }}"
                                   class="btn btn-primary btn-sm">
                                    Ver detalle
                                </a>

                                {% if producto.stock > 0 %}
                                    <a href="{{ path('carrito_add', {'id': producto.id}) }}"
                                       class="btn btn-success">
                                        Añadir al carrito
                                    </a>
                                {% else %}
                                    <button class="btn btn-secondary" disabled>
                                        Sin stock
                                    </button>
                                {% endif %}

                            </div>

                        </div>
                    </div>
                </div>

            {% else %}
                <p>No hay productos disponibles.</p>
            {% endfor %}
        </div>

    </div>

{% endblock %}
